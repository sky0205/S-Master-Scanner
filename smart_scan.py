import streamlit as st
import pandas as pd

# 1. ì•± ê¸°ë³¸ ì„¤ì • ë° ìŠ¤íƒ€ì¼
st.set_page_config(page_title="S-Master Scanner", layout="wide")
st.markdown("""
    <style>
    .stButton>button { width: 100%; border-radius: 5px; height: 3em; }
    .report-card { background-color: #f0f2f6; padding: 20px; border-radius: 10px; }
    </style>
    """, unsafe_allow_html=True)

# 2. ì‚¬ì´ë“œë°”: ì‹¬ë¦¬ì  ì•ˆì „ì¥ì¹˜ ë° ì§€ìˆ˜ ë³€ë™ì„± (ì„¤ì •ê°’)
st.sidebar.header("ğŸ›¡ï¸ ì‹¬ë¦¬ì  ì•ˆì „ì¥ì¹˜")
market_status = st.sidebar.selectbox("í˜„ì¬ ì‹œì¥ ëª¨ë“œ", ["ì •ìƒ", "ê¸°ê´€ ê´‘ê¸° ë§¤ì§‘", "ì§€ìˆ˜ ë³€ë™ì„± í™•ëŒ€"])
vix_index = st.sidebar.slider("ì§€ìˆ˜ ë³€ë™ì„± ìˆ˜ì¹˜", 0, 100, 25)

# 3. ë©”ì¸ íƒ€ì´í‹€
st.title("ğŸš€ S-Master Scanner")
st.subheader("ì…ì²´ì  íŒë…: ì „ ì¢…ëª© ì‹¤ì‹œê°„ ì €ê²© ë° ìˆ˜ê¸‰ DNA ë¶„ì„")

# 4. ì¢…ëª© ê²€ìƒ‰ ê¸°ëŠ¥ (ğŸ” ë²„íŠ¼ ë° ì¦‰ì‹œ ì „í™˜)
search_query = st.text_input("ğŸ” ë¶„ì„í•  ì¢…ëª©ëª… ë˜ëŠ” ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”", key="search_input")

# 5. [ì¥ë§ˆê° ë’¤] ìˆ˜ê¸‰ ìš°ì„ ìˆœìœ„ ë°ì´í„° (ì˜ˆì‹œ ë°ì´í„°ë² ì´ìŠ¤)
# ì‹¤ì œ ìš´ì˜ ì‹œì—ëŠ” APIë¥¼ í†µí•´ ì™¸ì¸/ê¸°ê´€ ìˆœë§¤ìˆ˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ìˆœìœ„ë¥¼ ë§¤ê¹ë‹ˆë‹¤.
data = {
    "ìˆœìœ„": [1, 2, 3],
    "ì¢…ëª©ëª…": ["ì‚¼ì„±ì „ì", "ì‹¤ë¦¬ì½˜íˆ¬", "IONQ"],
    "ì™¸ì¸/ê¸°ê´€ ìˆ˜ê¸‰": ["ê¸°ê´€ ë¯¸ì¹œë“¯í•œ ë§¤ì§‘", "ì™¸ì¸/ê¸°ê´€ ë™ë°˜ë§¤ìˆ˜", "ê¸°ê´€ ë§¤ìˆ˜/ì™¸ì¸ ë§¤ë„"],
    "ìˆ˜ê¸‰ DNA": ["ê¸°ê´€ ë³¸ì „ ì•„ë˜", "ì„¸ë ¥ ë§¤ì§‘ êµ¬ê°„", "í‰ë‹¨ê°€ ìœ„ ê³¼ì—´"],
    "ì‹ í˜¸ë“±": ["ğŸ”´ ë§¤ìˆ˜", "ğŸ”´ ë§¤ìˆ˜", "ğŸŸ¡ ê´€ë§"]
}
priority_df = pd.DataFrame(data)

# 6. í™”ë©´ êµ¬ì„±: ìš°ì„ ìˆœìœ„ ë¦¬ìŠ¤íŠ¸ vs ì¢…ëª© ìƒì„¸ ë¶„ì„
if not search_query:
    st.write("---")
    st.header("ğŸ“… ì¥ë§ˆê° í›„ ìˆ˜ê¸‰ ì‚¬ëƒ¥ ë¦¬ìŠ¤íŠ¸ (ìš°ì„ ìˆœìœ„)")
    st.table(priority_df)
    
    st.write("### ğŸ” ìµœê·¼ ê²€ìƒ‰ ì¢…ëª©")
    cols = st.columns(4)
    for i, stock in enumerate(data["ì¢…ëª©ëª…"]):
        if cols[i].button(f"ğŸ” {stock}"):
            st.session_state.search_input = stock
            st.rerun()

else:
    # ì¢…ëª© ìƒì„¸ ë¶„ì„ í™”ë©´ (ì´ìˆ˜ í• ì•„ë²„ì§€ ì–‘ì‹)
    st.write("---")
    st.header(f"ğŸ“Š {search_query} ì…ì²´ íŒë… ë³´ê³ ì„œ")
    
    # ìƒë‹¨ ì‹ í˜¸ë“±
    st.success("ğŸ”´ ë§¤ìˆ˜(ì ê¸°) - ê¸°ê´€ ë³¸ì „ë³´ë‹¤ ì €ë ´í•˜ë©° ê±°ë˜ëŸ‰ ìœ ì… ëŒ€ê¸° ì¤‘")
    
    # ì¶”ì„¸ ë¶„ì„ ì¹´ë“œ
    with st.container():
        st.markdown('<div class="report-card">', unsafe_allow_html=True)
        st.subheader("ğŸ“‹ ì¶”ì„¸ ë¶„ì„ ì¹´ë“œ")
        st.write(f"ì–´ë¥´ì‹ , í˜„ì¬ {search_query}ì€(ëŠ”) ê¸°ê´€ì˜ ë§¤ì§‘ì´ ëšœë ·í•˜ê²Œ í¬ì°©ë˜ëŠ” ì•„ì£¼ ê·€í•œ ì‚¬ëƒ¥ê°ì…ë‹ˆë‹¤. "
                 "ì™¸ì¸ê³¼ ê¸°ê´€ì˜ ë§¤ìˆ˜ë§¤ë„ í˜„í™©ì„ ë³´ë‹ˆ, ê·¸ë“¤ì´ ë¨¼ì € ìë¦¬ë¥¼ ì¡ê³  ê±°ë˜ëŸ‰ì´ í„°ì§€ê¸°ë§Œì„ ê¸°ë‹¤ë¦¬ëŠ” ëª¨ìŠµì´ ì„ ëª…í•˜ë„¤ìš”. "
                 "ì‹¬ë¦¬ì ìœ¼ë¡œ í”ë“¤ë¦¬ì§€ ë§ˆì‹œê³  ë°ì´í„°ê°€ ê°€ë¦¬í‚¤ëŠ” ë°©í–¥ì„ ë¯¿ìœ¼ì…”ë„ ì¢‹ìŠµë‹ˆë‹¤.")
        st.markdown('</div>', unsafe_allow_html=True)

    # ì§€í‘œ ì§„ë‹¨ (20/2, 14/6, 14/9)
    col1, col2 = st.columns(2)
    with col1:
        st.write("### ğŸ’° í…Œì´ë²„ì˜ ì ì •ì£¼ê°€")
        st.info("êµ­ë‚´: 195,000ì› / ë¯¸êµ­: $14.50")
        
        st.write("### ğŸ“Š ì§€í‘œ ìƒì„¸ ì§„ë‹¨")
        st.write("**Bollinger (20, 2)** â— ìœ„ì¹˜: í•˜ë‹¨ ë°´ë“œ ì•ˆì°© í›„ ë°˜ë“± ì‹œë„")
        st.write("**RSI (14, 9)** â— ìƒì„¸ ìˆ˜ì¹˜: 32 (ê³¼ë§¤ë„ íƒˆì¶œ ì¤‘)")
        st.write("**Williams %R (14, 6)** â— ìƒì„¸ ìˆ˜ì¹˜: -85 (ë°”ë‹¥ í™•ì¸)")
        st.write("**MACD** â–  ì¶”ì„¸: í•˜ë½ ë‘”í™” ë° ìƒìŠ¹(â–²) ì „í™˜ ì¤€ë¹„")

    if st.button("â¬…ï¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°"):
        st.session_state.search_input = ""
        st.rerun()